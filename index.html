<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minecraft Server Discovery</title>
  <link rel="icon" href="https://via.placeholder.com/32?text=MC" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.6/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #1a202c;
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
    }
    .minecraft-bg {
      background-image: linear-gradient(rgba(26, 32, 44, 0.8), rgba(26, 32, 44, 0.8)), url('https://images.unsplash.com/photo-1612036782188-736159a90bab?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
      background-size: cover;
      background-position: center;
    }
    .server-card {
      border: 2px solid #a855f7;
      border-radius: 0.5rem;
      padding: 1.5rem;
    }
    .suggest-section {
      border: 2px solid #a855f7;
      border-radius: 0.5rem;
      padding: 1.5rem;
    }
  </style>
</head>
<body class="minecraft-bg min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const BACKEND_URL = 'http://localhost:3000'; // Replace with your backend URL after deployment

    const ServerCard = ({ server }) => {
      const [iconSrc, setIconSrc] = React.useState(`https://api.mcsrvstat.us/icon/${server.ip}`);

      const handleIconError = (e, retryCount = 0) => {
        if (retryCount < 2) {
          setTimeout(() => {
            setIconSrc(`https://api.mcsrvstat.us/icon/${server.ip}?t=${Date.now()}`);
          }, 1000);
        } else {
          e.target.src = 'https://via.placeholder.com/48?text=MC';
        }
      };

      return (
        <div className="server-card bg-gray-800 shadow-lg hover:shadow-xl transition-shadow duration-300 flex items-start gap-4">
          <img
            src={iconSrc}
            alt={`${server.name} icon`}
            className="w-12 h-12 rounded"
            onError={(e) => handleIconError(e, server.iconRetryCount || 0)}
          />
          <div className="flex-1">
            <h3 className="text-xl font-bold text-purple-400">{server.name}</h3>
            <p className="text-gray-400 text-sm mt-1">{server.description}</p>
            <p className="text-gray-100 mt-1"><strong>IP:</strong> {server.ip}</p>
            <p className="text-gray-100 mt-1"><strong>Players:</strong> {server.playerCount}/{server.maxPlayers}</p>
            <p className="text-gray-100 mt-1"><strong>Status:</strong> {server.isOnline ? <span className="text-purple-400">Online</span> : <span className="text-red-400">Offline</span>}</p>
            <a href={server.discord} target="_blank" className="text-blue-400 hover:text-blue-300 mt-1 inline-block">Join Discord</a>
            <div className="mt-2">
              {server.tags.map(tag => (
                <span key={tag} className="inline-block bg-gray-700 text-gray-200 text-sm px-2 py-1 rounded mr-2">{tag}</span>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [servers, setServers] = React.useState([]);
      const [searchTerm, setSearchTerm] = React.useState("");
      const [playerFilter, setPlayerFilter] = React.useState("");
      const [statusFilter, setStatusFilter] = React.useState("all");
      const [tagFilter, setTagFilter] = React.useState("");
      const [currentPage, setCurrentPage] = React.useState(1);
      const [suggestName, setSuggestName] = React.useState("");
      const [suggestIp, setSuggestIp] = React.useState("");
      const [suggestDescription, setSuggestDescription] = React.useState("");
      const [suggestTags, setSuggestTags] = React.useState("");
      const [profile, setProfile] = React.useState(JSON.parse(localStorage.getItem("profile") || "{}"));
      const [newUsername, setNewUsername] = React.useState(profile.username || "");
      const [newEmail, setNewEmail] = React.useState(profile.email || "");
      const [newPassword, setNewPassword] = React.useState("");
      const [newProfilePic, setNewProfilePic] = React.useState(profile.profilePic || "");
      const [showModal, setShowModal] = React.useState(false);
      const serversPerPage = 10;

      const tags = [...new Set(servers.flatMap(server => server.tags))].sort();

      React.useEffect(() => {
        const fetchServers = async () => {
          try {
            const response = await axios.get(`${BACKEND_URL}/api/servers`);
            const serversData = await Promise.all(
              response.data.map(async server => {
                try {
                  const statusResponse = await axios.get(`https://api.mcsrvstat.us/3/${server.ip}`);
                  const data = statusResponse.data;
                  return {
                    ...server,
                    isOnline: data.online !== false,
                    playerCount: data.online ? (data.players?.online || 0) : 0,
                    maxPlayers: data.online ? (data.players?.max || 1000) : 1000,
                    iconRetryCount: 0,
                  };
                } catch (error) {
                  console.error(`Failed to fetch data for ${server.ip}:`, error);
                  return { ...server, isOnline: true, playerCount: 0, maxPlayers: 1000, iconRetryCount: 0 };
                }
              })
            );
            setServers(serversData);
          } catch (error) {
            console.error('Failed to fetch servers:', error);
          }
        };
        fetchServers();
      }, []);

      const handleProfileSubmit = (e) => {
        e.preventDefault();
        if (newUsername.trim()) {
          const updatedProfile = {
            username: newUsername,
            email: newEmail,
            password: newPassword ? btoa(newPassword) : profile.password,
            profilePic: newProfilePic || profile.profilePic || "https://via.placeholder.com/64?text=User",
          };
          localStorage.setItem("profile", JSON.stringify(updatedProfile));
          setProfile(updatedProfile);
          setNewUsername(updatedProfile.username);
          setNewEmail(updatedProfile.email);
          setNewPassword("");
          setNewProfilePic("");
          setShowModal(false);
        } else {
          alert("Username is required.");
        }
      };

      const handleProfilePicChange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => setNewProfilePic(reader.result);
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!profile.username) {
          alert("Please create a profile to suggest a server.");
          return;
        }
        try {
          const suggestion = {
            name: suggestName,
            ip: suggestIp,
            discord: suggestIp,
            description: suggestDescription,
            tags: suggestTags.split(',').map(tag => tag.trim()),
            userId: profile.username,
            status: 'pending',
          };
          const response = await axios.post(`${BACKEND_URL}/api/suggestions`, suggestion);
          alert(`Server suggestion submitted! ID: ${response.data._id}`);
          setSuggestName("");
          setSuggestIp("");
          setSuggestDescription("");
          setSuggestTags("");
        } catch (error) {
          console.error('Failed to submit suggestion:', error);
          alert("Error submitting suggestion.");
        }
      };

      const filteredServers = servers.filter(
        server =>
          (server.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          server.ip.toLowerCase().includes(searchTerm.toLowerCase()) ||
          server.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))) &&
          (playerFilter === "" || server.playerCount >= parseInt(playerFilter)) &&
          (statusFilter === "all" || (statusFilter === "online" && server.isOnline) || (statusFilter === "offline" && !server.isOnline)) &&
          (tagFilter === "" || server.tags.includes(tagFilter))
      );

      const totalPages = Math.ceil(filteredServers.length / serversPerPage);
      const paginatedServers = filteredServers.slice(
        (currentPage - 1) * serversPerPage,
        currentPage * serversPerPage
      );

      const handlePageChange = (page) => {
        setCurrentPage(page);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      return (
        <div className="container mx-auto p-6 relative">
          <button
            onClick={() => setShowModal(true)}
            className="absolute top-4 left-4 text-purple-400 hover:text-purple-500"
            title={profile.username ? `Logged in as ${profile.username}` : "Sign Up / Log In"}
          >
            <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5zm0 2c-2.67 0-8 1.335-8 4v2h16v-2c0-2.665-5.33-4-8-4z"/>
            </svg>
          </button>
          <div className="absolute top-4 right-4 flex gap-2">
            <a
              href="https://discord.gg/oxied"
              target="_blank"
              className="text-purple-400 hover:text-purple-500"
              title="Join Our Discord"
            >
              <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.942 5.556a16.816 16.816 0 0 0-4.126-1.308 12.796 12.796 0 0 0-.663 1.457c-1.629-.232-3.22-.232-4.816 0-.252-.595-.55-1.162-.663-1.457A16.823 16.823 0 0 0 4.548 5.556a16.676 16.676 0 0 0-2.078 9.273 17.317 17.317 0 0 0 5.192 2.627c.252-.363.504-.75.723-1.157-.974-.346-1.905-.865-2.738-1.536.068-.046.135-.094.2-.143 2.057.944 4.296.944 6.343 0 .065.049.132.097.2.143-.833.671-1.764 1.19-2.738 1.536.219.407.471.794.723 1.157a17.284 17.284 0 0 0 5.192-2.627 16.676 16.676 0 0 0-2.078-9.273zM8.523 14.087c-.623 0-1.14-.573-1.14-1.275s.508-1.275 1.14-1.275c.635 0 1.146.573 1.14 1.275 0 .702-.512 1.275-1.14 1.275zm6.954 0c-.623 0-1.14-.573-1.14-1.275s.508-1.275 1.14-1.275c.635 0 1.146.573 1.14 1.275 0 .702-.512 1.275-1.14 1.275z"/>
              </svg>
            </a>
            <a
              href="https://www.tiktok.com/@oxied_site"
              target="_blank"
              className="text-purple-400 hover:text-purple-500"
              title="Follow us on TikTok"
            >
              <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19.589 6.686a4.793 4.793 0 0 1-3.77-4.245V2h-3.445v13.672a2.896 2.896 0 0 1-5.201 1.743 2.896 2.896 0 0 1-.429-3.248 2.896 2.896 0 0 1 3.138-1.247V8.615a7.256 7.256 0 0 0-6.626 4.117 7.256 7.256 0 0 0 1.042 8.068 7.256 7.256 0 0 0 8.068 1.042 7.256 7.256 0 0 0 4.117-6.626V9.081a8.736 8.736 0 0 0 3.106.605V6.24a4.784 4.784 0 0 1-1.4.446z"/>
              </svg>
            </a>
            <a
              href="https://www.instagram.com/oxied_site"
              target="_blank"
              className="text-purple-400 hover:text-purple-500"
              title="Follow us on Instagram"
            >
              <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.336 3.608 1.311.975.975 1.249 2.242 1.311 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.336 2.633-1.311 3.608-.975.975-2.242 1.249-3.608 1.311-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.336-3.608-1.311-.975-.975-1.249-2.242-1.311-3.608-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.062-1.366.336-2.633 1.311-3.608.975-.975 2.242-1.249 3.608-1.311 1.266-.058 1.646-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-1.425.064-2.854.364-3.927 1.437-1.073 1.073-1.373 2.502-1.437 3.927-.058 1.28-.072 1.688-.072 4.947s.014 3.667.072 4.947c.064 1.425.364 2.854 1.437 3.927 1.073 1.073 2.502 1.373 3.927 1.437 1.28.058 1.688.072 4.947.072s3.667-.014 4.947-.072c1.425-.064 2.854-.364 3.927-1.437 1.073-1.073 1.373-2.502 1.437-3.927.058-1.28.072-1.688.072-4.947s-.014-3.667-.072-4.947c-.064-1.425-.364-2.854-1.437-3.927-1.073-1.073-2.502-1.373-3.927-1.437-1.28-.058-1.688-.072-4.947-.072zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998zm6.406-11.845a1.44 1.44 0 1 1 0 2.88 1.44 1.44 0 0 1 0-2.88z"/>
              </svg>
            </a>
          </div>
          <div className="flex items-center justify-center mb-8">
            <img
              src="https://via.placeholder.com/32?text=MC"
              alt="Website Icon"
              className="w-8 h-8 mr-2"
            />
            <h1 className="text-4xl font-bold text-purple-400">Minecraft Server Discovery</h1>
          </div>
          {showModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
              <div className="bg-gray-800 p-6 rounded-lg max-w-md w-full">
                <h2 className="text-xl text-purple-400 mb-4">{profile.username ? "Edit Profile" : "Create Profile"}</h2>
                <div className="flex items-center mb-4">
                  <img
                    src={newProfilePic || profile.profilePic || "https://via.placeholder.com/64?text=User"}
                    alt="Profile Picture"
                    className="w-16 h-16 rounded-full mr-4"
                  />
                  <input
                    type="file"
                    accept="image/*"
                    onChange={handleProfilePicChange}
                    className="text-gray-200"
                  />
                </div>
                <input
                  type="text"
                  placeholder="Enter username"
                  value={newUsername}
                  onChange={e => setNewUsername(e.target.value)}
                  className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
                <input
                  type="email"
                  placeholder="Enter email"
                  value={newEmail}
                  onChange={e => setNewEmail(e.target.value)}
                  className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
                <input
                  type="password"
                  placeholder="Enter password"
                  value={newPassword}
                  onChange={e => setNewPassword(e.target.value)}
                  className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
                <div className="flex justify-end gap-2">
                  <button onClick={() => setShowModal(false)} className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
                  <button onClick={handleProfileSubmit} className="bg-purple-400 text-white px-4 py-2 rounded hover:bg-purple-500">Submit</button>
                </div>
                {profile.username && (
                  <button
                    onClick={() => { localStorage.removeItem("profile"); setProfile({}); setNewUsername(""); setNewEmail(""); setNewPassword(""); setNewProfilePic(""); setShowModal(false); }}
                    className="mt-2 text-purple-400 hover:text-purple-500"
                  >
                    Logout
                  </button>
                )}
              </div>
            </div>
          )}
          <div className="mb-6 flex flex-col md:flex-row gap-4">
            <input
              type="text"
              placeholder="Search servers by name, IP, or tags..."
              value={searchTerm}
              onChange={e => setSearchTerm(e.target.value)}
              className="flex-1 p-3 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
            />
            <input
              type="number"
              placeholder="Min players..."
              value={playerFilter}
              onChange={e => setPlayerFilter(e.target.value)}
              className="w-full md:w-40 p-3 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
            />
            <select
              value={statusFilter}
              onChange={e => setStatusFilter(e.target.value)}
              className="w-full md:w-40 p-3 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
            >
              <option value="all">All Status</option>
              <option value="online">Online</option>
              <option value="offline">Offline</option>
            </select>
            <select
              value={tagFilter}
              onChange={e => setTagFilter(e.target.value)}
              className="w-full md:w-40 p-3 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
            >
              <option value="">All Tags</option>
              {tags.map(tag => <option key={tag} value={tag}>{tag}</option>)}
            </select>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {paginatedServers.length > 0 ? (
              paginatedServers.map(server => <ServerCard key={server.ip} server={server} />)
            ) : (
              <p className="text-gray-400 text-center col-span-full">No servers found.</p>
            )}
          </div>
          <div className="flex justify-center mt-6 gap-2">
            {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (
              <button
                key={page}
                onClick={() => handlePageChange(page)}
                className={`px-4 py-2 rounded ${currentPage === page ? 'bg-purple-400 text-white' : 'bg-gray-700 text-gray-200 hover:bg-gray-600'}`}
              >
                {page}
              </button>
            ))}
          </div>
          <footer className="mt-12 p-6 bg-gray-800 rounded-lg text-center">
            <h2 className="text-2xl font-bold text-purple-400 mb-4">Join Our Community</h2>
            <p className="text-gray-300 mb-4">Connect with us and other Minecraft players!</p>
            <a
              href="https://discord.gg/oxied"
              target="_blank"
              className="inline-block bg-purple-400 text-white px-4 py-2 rounded hover:bg-purple-500 transition-colors mb-4"
            >
              Join Our Discord
            </a>
            <p className="text-gray-300 mb-4">Support our site to keep it running!</p>
            <a
              href="https://ko-fi.com/oxied_site"
              target="_blank"
              className="inline-block bg-purple-400 text-white px-4 py-2 rounded hover:bg-purple-500 transition-colors mb-4"
            >
              Donate to Us
            </a>
            <h2 className="text-2xl font-bold text-purple-400 mb-4">Suggest a Server</h2>
            <div className="suggest-section max-w-md mx-auto">
              <input
                type="text"
                placeholder="Server Name"
                value={suggestName}
                onChange={e => setSuggestName(e.target.value)}
                className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
              />
              <input
                type="text"
                placeholder="Server IP"
                value={suggestIp}
                onChange={e => setSuggestIp(e.target.value)}
                className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
              />
              <input
                type="text"
                placeholder="Discord Invite Link"
                value={suggestDiscord}
                onChange={e => setSuggestDiscord(e.target.value)}
                className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
              />
              <textarea
                placeholder="Server Description"
                value={suggestDescription}
                onChange={e => setSuggestDescription(e.target.value)}
                className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
              />
              <input
                type="text"
                placeholder="Comma-separated tags"
                value={suggestTags}
                onChange={e => setSuggestTags(e.target.value)}
                className="w-full p-3 mb-2 rounded-lg bg-gray-700 text-gray-200 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400"
              />
              <button
                onClick={handleSubmit}
                className="w-full bg-purple-400 text-white px-4 py-2 rounded hover:bg-purple-500 transition-colors"
              >
                Submit Server Suggestion
              </button>
            </div>
          </footer>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
